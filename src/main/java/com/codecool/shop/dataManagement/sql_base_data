SET statement_timeout = 0;
SET lock_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET default_tablespace = '';
SET default_with_oids = false;

---
--- drop tables
---

DROP TABLE IF EXISTS category CASCADE;
DROP TABLE IF EXISTS supplier CASCADE;
DROP TABLE IF EXISTS product CASCADE;

---
--- create tables
---

CREATE TABLE category(
                          id            SERIAL PRIMARY KEY     NOT NULL,
                          name          VARCHAR(200)           NOT NULL,
                          department    VARCHAR(200)           NOT NULL,
                          description   VARCHAR(200)           NOT NULL
);

CREATE TABLE supplier(
                          id            SERIAL PRIMARY KEY     NOT NULL,
                          name          VARCHAR(200)           NOT NULL,
                          description   VARCHAR(200)           NOT NULL
);

CREATE TABLE product(
                          id            SERIAL PRIMARY KEY     NOT NULL,
                          name          VARCHAR(200)           NOT NULL,
                          value         decimal (200)          NOT NULL,
                          currency      VARCHAR(200)           NOT NULL,
                          description   VARCHAR(200)           NOT NULL,
                          category_id   integer                NOT NULL,
                          supplier_id   integer                NOT NULL
);

---
--- insert data
---

INSERT INTO category
    (ID, NAME, DEPARTMENT, DESCRIPTION)
VALUES
    (nextval('category_id_seq'),'Tablet', 'Hardware', 'A tablet computer, commonly shortened to tablet, is a thin, flat mobile computer with a touchscreen display.');


INSERT INTO supplier
    (ID, NAME, DESCRIPTION)
VALUES
    (nextval('supplier_id_seq'), 'Amazon', 'Digital content and services'),
    (nextval('supplier_id_seq'), 'Lenovo', 'Computers');


INSERT INTO product
    (id, name, "value", currency, description, category_id, supplier_id)
VALUES
    (nextval('product_id_seq'), 'Amazon Fire', 49.9, 'USD',
        'Fantastic price. Large content ecosystem. Good parental controls. Helpful technical support.', 1, 1),
    (nextval('product_id_seq'), '"Lenovo IdeaPad Miix 700', 479, 'USD',
        'Keyboard cover is included. Fanless Core m5 processor. Full-size USB ports. Adjustable kickstand.', 1, 2),
    (nextval('product_id_seq'), 'Amazon Fire HD 8', 89, 'USD',
        'Amazon`s latest Fire HD 8 tablet is a great value for media consumption.', 1, 1);

---
--- add constraints
---

ALTER TABLE ONLY product
    ADD CONSTRAINT fk_category_product_id FOREIGN KEY (category_id) REFERENCES category(id) ON DELETE CASCADE,
    ADD CONSTRAINT fk_supplier_product_id FOREIGN KEY (supplier_id) REFERENCES supplier(id) ON DELETE CASCADE;